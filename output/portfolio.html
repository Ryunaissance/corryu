<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í¬íŠ¸í´ë¦¬ì˜¤ ë¹Œë” â€” CORRYU</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
<script src="/i18n.js"></script>
<style>
:root {
  --bg-primary: #0a0d14; --bg-card: rgba(18,22,36,0.92);
  --border: rgba(255,255,255,0.07); --text-primary: #e2e8f0;
  --text-muted: #64748b; --accent: #3b82f6;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: var(--bg-primary); color: var(--text-primary); font-family: 'Inter', sans-serif; min-height: 100vh; -webkit-font-smoothing: antialiased; }
.glass { background: var(--bg-card); backdrop-filter: blur(16px); border: 1px solid var(--border); border-radius: 14px; }
.text-gradient { background: linear-gradient(135deg,#60a5fa,#a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.gradient-line { position: fixed; top: 0; left: 0; right: 0; height: 3px; z-index: 200; background: linear-gradient(90deg,#3b82f6,#8b5cf6,#ec4899,#f59e0b); }
nav { position: fixed; top: 3px; left: 0; right: 0; z-index: 100; background: rgba(10,13,20,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); height: 56px; display: flex; align-items: center; }
.nav-inner { max-width: 1320px; margin: 0 auto; padding: 0 24px; width: 100%; display: flex; align-items: center; gap: 14px; }
.nav-back { display: flex; align-items: center; gap: 6px; color: var(--text-muted); font-size: 0.82rem; font-weight: 600; text-decoration: none; transition: color 0.15s; }
.nav-back:hover { color: #60a5fa; }
.main-wrap { max-width: 900px; margin: 0 auto; padding: 76px 20px 48px; }

/* â”€â”€ ë¡œê·¸ì¸ ê²Œì´íŠ¸ â”€â”€ */
#gate-view {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  min-height: 70vh; text-align: center; padding: 24px;
}
.gate-card {
  padding: 48px 40px; border-radius: 20px; max-width: 420px; width: 100%;
  position: relative; overflow: hidden;
}
.gate-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg,#3b82f6,#8b5cf6,#ec4899);
}
.lock-icon {
  width: 56px; height: 56px; border-radius: 16px;
  background: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.2);
  display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;
}
.gate-title { font-size: 1.35rem; font-weight: 900; margin-bottom: 10px; }
.gate-desc { font-size: 0.85rem; color: var(--text-muted); line-height: 1.7; margin-bottom: 28px; }
.benefit-list { text-align: left; margin-bottom: 28px; }
.benefit-item { display: flex; align-items: flex-start; gap: 10px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 0.83rem; }
.benefit-item:last-child { border-bottom: none; }
.benefit-icon { color: #4ade80; flex-shrink: 0; margin-top: 1px; }
.benefit-text { color: #94a3b8; }
.benefit-text strong { color: var(--text-primary); }
.btn-primary {
  display: block; width: 100%; padding: 12px; border-radius: 10px; border: none;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white;
  font-size: 0.9rem; font-weight: 800; cursor: pointer; font-family: inherit;
  text-decoration: none; text-align: center; margin-bottom: 10px;
  transition: filter 0.15s; letter-spacing: 0.01em;
}
.btn-primary:hover { filter: brightness(1.1); }
.btn-secondary {
  display: block; width: 100%; padding: 11px; border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1); background: none; color: var(--text-muted);
  font-size: 0.85rem; font-weight: 600; cursor: pointer; font-family: inherit;
  text-decoration: none; text-align: center; transition: all 0.15s;
}
.btn-secondary:hover { color: var(--text-primary); border-color: rgba(255,255,255,0.2); }
.gate-footnote { font-size: 0.72rem; color: #334155; margin-top: 16px; }

/* â”€â”€ í¬íŠ¸í´ë¦¬ì˜¤ ë·° (ë¡œê·¸ì¸ í›„ â€” í”Œë ˆì´ìŠ¤í™€ë”) â”€â”€ */
#portfolio-view { display: none; }
.page-title { font-size: 1.5rem; font-weight: 900; letter-spacing: -0.03em; margin-bottom: 20px; }
.section-card { padding: 24px; margin-bottom: 16px; }
.section-title { font-size: 0.78rem; font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
.section-title::after { content:''; flex:1; height:1px; background:var(--border); }

/* í¬íŠ¸í´ë¦¬ì˜¤ ì…ë ¥ í¼ */
.pf-row { display: grid; grid-template-columns: 1fr 100px 80px 36px; gap: 8px; align-items: center; margin-bottom: 8px; }
.pf-row-header { display: grid; grid-template-columns: 1fr 100px 80px 36px; gap: 8px; margin-bottom: 8px; font-size: 0.72rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em; }
.pf-input {
  background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 8px;
  color: var(--text-primary); font-family: inherit; font-size: 0.85rem; padding: 8px 10px;
  outline: none; transition: border-color 0.15s; width: 100%;
}
.pf-input:focus { border-color: rgba(59,130,246,0.5); }
.pf-input::placeholder { color: var(--text-muted); }
.pf-remove-btn {
  background: none; border: 1px solid rgba(248,113,113,0.2); border-radius: 6px;
  color: #f87171; cursor: pointer; font-size: 0.8rem; padding: 0; height: 36px; width: 36px;
  display: flex; align-items: center; justify-content: center; transition: all 0.15s; font-family: inherit;
}
.pf-remove-btn:hover { background: rgba(248,113,113,0.1); }
.pf-add-btn {
  background: none; border: 1px dashed rgba(59,130,246,0.3); border-radius: 8px;
  color: #60a5fa; cursor: pointer; font-size: 0.82rem; font-weight: 600;
  padding: 8px 14px; font-family: inherit; transition: all 0.15s; width: 100%;
  display: flex; align-items: center; justify-content: center; gap: 6px;
}
.pf-add-btn:hover { background: rgba(59,130,246,0.05); border-color: rgba(59,130,246,0.5); }

/* ìš”ì•½ í†µê³„ */
.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px; }
.stat-box { padding: 16px; background: rgba(255,255,255,0.02); border: 1px solid var(--border); border-radius: 10px; text-align: center; }
.stat-label { font-size: 0.7rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }
.stat-value { font-size: 1.2rem; font-weight: 900; }

/* ë¹„ì¤‘ ë°” */
.weight-bar-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.wbi-ticker { font-size: 0.8rem; font-weight: 700; color: #60a5fa; width: 55px; flex-shrink: 0; }
.wbi-bar-bg { flex: 1; height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden; }
.wbi-bar { height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); border-radius: 3px; transition: width 0.4s ease; }
.wbi-pct { font-size: 0.8rem; font-weight: 700; width: 45px; text-align: right; flex-shrink: 0; }

/* ìƒê´€ê´€ê³„ íŒíŠ¸ */
.corr-hint { padding: 16px; background: rgba(59,130,246,0.04); border: 1px solid rgba(59,130,246,0.1); border-radius: 10px; font-size: 0.82rem; color: var(--text-muted); line-height: 1.7; }

/* ì €ì¥ ë²„íŠ¼ ì˜ì—­ */
.save-bar { display: flex; gap: 10px; margin-top: 16px; }
.btn-save { flex: 1; padding: 11px; border-radius: 10px; border: none; background: linear-gradient(135deg,#3b82f6,#8b5cf6); color: white; font-size: 0.88rem; font-weight: 800; cursor: pointer; font-family: inherit; transition: filter 0.15s; }
.btn-save:hover { filter: brightness(1.1); }
.btn-logout { padding: 11px 18px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); background: none; color: var(--text-muted); font-size: 0.82rem; cursor: pointer; font-family: inherit; transition: all 0.15s; }
.btn-logout:hover { color: #f87171; border-color: rgba(248,113,113,0.3); }

/* Coming soon ì˜¤ë²„ë ˆì´ */
.coming-soon-overlay {
  position: absolute; inset: 0; border-radius: 14px; z-index: 10;
  background: rgba(10,13,20,0.75); backdrop-filter: blur(4px);
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;
}
.coming-badge { padding: 4px 12px; background: rgba(59,130,246,0.15); border: 1px solid rgba(59,130,246,0.3); border-radius: 20px; font-size: 0.75rem; font-weight: 700; color: #60a5fa; }

@media(max-width:600px) {
  .gate-card { padding: 32px 20px; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .pf-row, .pf-row-header { grid-template-columns: 1fr 80px 60px 32px; }
}
</style>
</head>
<body>
<div class="gradient-line"></div>

<nav>
  <div class="nav-inner">
    <a href="/index" class="nav-back">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
      ëŒ€ì‹œë³´ë“œ
    </a>
    <span style="color:#1e293b">/</span>
    <a href="/landing" style="font-size:0.95rem;font-weight:900;text-decoration:none"><span class="text-gradient">CORRYU</span></a>
    <span style="font-size:0.82rem;color:var(--text-muted)">/ í¬íŠ¸í´ë¦¬ì˜¤</span>
    <a href="/compare" style="margin-left:auto;font-size:0.78rem;color:var(--text-muted);text-decoration:none;font-weight:600;display:flex;align-items:center;gap:4px">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      ETF ë¹„êµ
    </a>
  </div>
</nav>

<div class="main-wrap">

  <!-- â”€â”€ ë¡œê·¸ì¸ ê²Œì´íŠ¸ â”€â”€ -->
  <div id="gate-view">
    <div class="glass gate-card">
      <div class="lock-icon">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0110 0v4"/>
        </svg>
      </div>
      <div class="gate-title">í¬íŠ¸í´ë¦¬ì˜¤ ë¹Œë”</div>
      <p class="gate-desc">
        ë³´ìœ  ETFë¥¼ ì…ë ¥í•˜ë©´ CORRYUê°€ <strong style="color:var(--text-primary)">ê°€ì¤‘ CAGRÂ·ë³€ë™ì„±Â·Sortino</strong> ë“±<br>
        í¬íŠ¸í´ë¦¬ì˜¤ ì „ì²´ ì§€í‘œë¥¼ ìë™ìœ¼ë¡œ ê³„ì‚°í•´ ë“œë¦½ë‹ˆë‹¤.<br><br>
        ë¡œê·¸ì¸í•˜ë©´ ë°ì´í„°ê°€ <strong style="color:var(--text-primary)">ì„œë²„ì— ì•ˆì „í•˜ê²Œ ì €ì¥</strong>ë˜ì–´<br>
        ê¸°ê¸°ê°€ ë°”ë€Œì–´ë„ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
      <div class="benefit-list">
        <div class="benefit-item">
          <span class="benefit-icon">âœ¦</span>
          <span class="benefit-text"><strong>ê°€ì¤‘ í‰ê·  ì§€í‘œ ê³„ì‚°</strong> â€” CAGR, Vol, Sortino, MDD í†µí•© ë¶„ì„</span>
        </div>
        <div class="benefit-item">
          <span class="benefit-icon">âœ¦</span>
          <span class="benefit-text"><strong>ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ</strong> â€” ì¢…ëª© ê°„ ë¶„ì‚° íš¨ê³¼ ì‹œê°í™”</span>
        </div>
        <div class="benefit-item">
          <span class="benefit-icon">âœ¦</span>
          <span class="benefit-text"><strong>Z-Score ê°€ì¤‘í‰ê· </strong> â€” ì§€ê¸ˆ ë‚´ í¬íŠ¸í´ë¦¬ì˜¤ì˜ ê³¼ì—´ë„</span>
        </div>
        <div class="benefit-item">
          <span class="benefit-icon">âœ¦</span>
          <span class="benefit-text"><strong>í´ë¼ìš°ë“œ ì €ì¥</strong> â€” ì–´ëŠ ê¸°ê¸°ì—ì„œë„ ë™ì¼í•œ ë°ì´í„°</span>
        </div>
      </div>
      <a href="/login" class="btn-primary">ë¡œê·¸ì¸í•˜ê¸°</a>
      <a href="/login#signup" class="btn-secondary">ë¬´ë£Œ ê³„ì • ë§Œë“¤ê¸°</a>
      <div class="gate-footnote">ë¡œì»¬ ì €ì¥(ì¿ í‚¤Â·localStorage)ì€ ë¸Œë¼ìš°ì € ì´ˆê¸°í™” ì‹œ ë°ì´í„°ê°€ ìœ ì‹¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>
  </div>

  <!-- â”€â”€ í¬íŠ¸í´ë¦¬ì˜¤ ë·° (ë¡œê·¸ì¸ í›„) â”€â”€ -->
  <div id="portfolio-view">

    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px">
      <div>
        <div class="page-title">ë‚´ <span class="text-gradient">í¬íŠ¸í´ë¦¬ì˜¤</span></div>
        <div style="font-size:0.8rem;color:var(--text-muted)" id="user-info-label">â€”</div>
      </div>
      <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <!-- í¬íŠ¸í´ë¦¬ì˜¤ í•©ì‚° ì§€í‘œ -->
    <div class="glass section-card">
      <div class="section-title">í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½</div>
      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-label">ê°€ì¤‘ CAGR</div>
          <div class="stat-value" id="summary-cagr" style="color:#4ade80">â€”</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">ê°€ì¤‘ ë³€ë™ì„±</div>
          <div class="stat-value" id="summary-vol" style="color:#f59e0b">â€”</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">ê°€ì¤‘ Sortino</div>
          <div class="stat-value" id="summary-sortino" style="color:#a78bfa">â€”</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Z-Score í‰ê· </div>
          <div class="stat-value" id="summary-zscore" style="color:#60a5fa">â€”</div>
        </div>
      </div>
      <!-- ë¹„ì¤‘ ë°” -->
      <div id="weight-bars"></div>
    </div>

    <!-- ì¢…ëª© ì…ë ¥ -->
    <div class="glass section-card">
      <div class="section-title">êµ¬ì„± ì¢…ëª© ì…ë ¥</div>
      <div class="pf-row-header">
        <div>í‹°ì»¤</div><div style="text-align:center">ë¹„ì¤‘ (%)</div><div style="text-align:center">ê¸ˆì•¡ ($)</div><div></div>
      </div>
      <div id="pf-rows"></div>
      <button class="pf-add-btn" onclick="addRow()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        ETF ì¶”ê°€
      </button>
      <div class="save-bar">
        <button class="btn-save" onclick="calculatePortfolio()">ê³„ì‚°í•˜ê¸°</button>
        <button class="btn-save" onclick="savePortfolio()" style="background:rgba(74,222,128,0.15);border:1px solid rgba(74,222,128,0.3);color:#4ade80">ì €ì¥</button>
      </div>
    </div>

    <!-- ìƒê´€ê´€ê³„ (Coming soon) -->
    <div class="glass section-card" style="position:relative;min-height:180px">
      <div class="section-title">ìƒê´€ê´€ê³„ ë¶„ì„</div>
      <div style="display:grid;grid-template-columns:repeat(3,60px);gap:4px;opacity:0.15">
        <div style="background:#3b82f6;height:60px;border-radius:6px"></div>
        <div style="background:#8b5cf640;height:60px;border-radius:6px"></div>
        <div style="background:#8b5cf620;height:60px;border-radius:6px"></div>
        <div style="background:#8b5cf640;height:60px;border-radius:6px"></div>
        <div style="background:#3b82f6;height:60px;border-radius:6px"></div>
        <div style="background:#3b82f680;height:60px;border-radius:6px"></div>
        <div style="background:#8b5cf620;height:60px;border-radius:6px"></div>
        <div style="background:#3b82f680;height:60px;border-radius:6px"></div>
        <div style="background:#3b82f6;height:60px;border-radius:6px"></div>
      </div>
      <div class="coming-soon-overlay">
        <span class="coming-badge">ğŸš§ ì¤€ë¹„ ì¤‘</span>
        <span style="font-size:0.82rem;color:var(--text-muted)">r_Anchor ê¸°ë°˜ ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ</span>
      </div>
    </div>

  </div><!-- /portfolio-view -->

</div><!-- /main-wrap -->

<script>
// â”€â”€ ì„¸ì…˜ ì²´í¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// corryu_session = { email, displayName } ê°€ localStorageì— ìˆìœ¼ë©´ ë¡œê·¸ì¸ ìƒíƒœ
function getSession() {
  try { return JSON.parse(localStorage.getItem('corryu_session') || 'null'); }
  catch { return null; }
}

function logout() {
  if (!confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  localStorage.removeItem('corryu_session');
  location.reload();
}

// â”€â”€ ETF ë°ì´í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let allData = {};
fetch('/etf_data.json').then(r=>r.json()).then(data => {
  for (const [, etfs] of Object.entries(data)) {
    for (const etf of etfs) allData[etf.ticker] = etf;
  }
  loadSavedPortfolio();
  calculatePortfolio();
}).catch(() => {});

// â”€â”€ í¬íŠ¸í´ë¦¬ì˜¤ í–‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let rows = [{ ticker: '', weight: '', amount: '' }];

function addRow() {
  if (rows.length >= 15) { alert('ìµœëŒ€ 15ê°œ ì¢…ëª©ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); return; }
  rows.push({ ticker: '', weight: '', amount: '' });
  renderRows();
}
function removeRow(i) {
  if (rows.length <= 1) return;
  rows.splice(i, 1);
  renderRows();
  calculatePortfolio();
}

function renderRows() {
  const container = document.getElementById('pf-rows');
  container.innerHTML = rows.map((r, i) => `
    <div class="pf-row" id="row-${i}">
      <input type="text" class="pf-input" placeholder="SPY" value="${r.ticker}"
        oninput="rows[${i}].ticker=this.value.toUpperCase();this.value=rows[${i}].ticker"
        onblur="calculatePortfolio()" style="text-transform:uppercase;font-weight:700">
      <input type="number" class="pf-input" placeholder="25" value="${r.weight}" min="0" max="100" step="0.1"
        oninput="rows[${i}].weight=this.value" onblur="calculatePortfolio()" style="text-align:center">
      <input type="number" class="pf-input" placeholder="5000" value="${r.amount}" min="0"
        oninput="rows[${i}].amount=this.value" style="text-align:right">
      <button class="pf-remove-btn" onclick="removeRow(${i})" title="ì œê±°">âœ•</button>
    </div>`).join('');
}

// â”€â”€ ê³„ì‚° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calculatePortfolio() {
  const valid = rows.filter(r => r.ticker && r.weight && allData[r.ticker.toUpperCase()]);
  if (valid.length === 0) { clearSummary(); return; }

  let totalW = valid.reduce((s, r) => s + parseFloat(r.weight), 0);
  if (totalW === 0) { clearSummary(); return; }

  let wCAGR = 0, wVol = 0, wSortino = 0, wZScore = 0, zCount = 0;
  const items = [];

  valid.forEach(r => {
    const etf = allData[r.ticker.toUpperCase()];
    const w = parseFloat(r.weight) / totalW;
    wCAGR    += (etf.cagr    || 0) * w;
    wVol     += (etf.vol     || 0) * w;
    wSortino += (etf.sortino || 0) * w;
    if (!etf.short_history && etf.z_score !== null && etf.z_score !== undefined) {
      wZScore += etf.z_score * w; zCount++;
    }
    items.push({ ticker: etf.ticker, weight: (parseFloat(r.weight)/totalW*100).toFixed(1) });
  });

  const fmt = (v, d=1) => (v>0?'+':'')+v.toFixed(d)+'%';
  document.getElementById('summary-cagr').textContent    = fmt(wCAGR);
  document.getElementById('summary-vol').textContent     = fmt(wVol);
  document.getElementById('summary-sortino').textContent = wSortino.toFixed(2);
  document.getElementById('summary-zscore').textContent  = zCount ? wZScore.toFixed(2) : 'â€”';

  // Z-Score ìƒ‰ìƒ
  const zsEl = document.getElementById('summary-zscore');
  zsEl.style.color = wZScore > 1.5 ? '#f87171' : wZScore < -1.5 ? '#60a5fa' : '#94a3b8';

  // ë¹„ì¤‘ ë°”
  const barHtml = items.map(it =>
    `<div class="weight-bar-item">
      <span class="wbi-ticker">${it.ticker}</span>
      <div class="wbi-bar-bg"><div class="wbi-bar" style="width:${it.weight}%"></div></div>
      <span class="wbi-pct">${it.weight}%</span>
    </div>`).join('');
  document.getElementById('weight-bars').innerHTML = barHtml;
}

function clearSummary() {
  ['summary-cagr','summary-vol','summary-sortino','summary-zscore'].forEach(id => {
    document.getElementById(id).textContent = 'â€”';
  });
  document.getElementById('weight-bars').innerHTML = '';
}

// â”€â”€ ì €ì¥ / ë¶ˆëŸ¬ì˜¤ê¸° (ì„œë²„ ì—°ë™ ì „ ì„ì‹œ: localStorage) â”€â”€
// NOTE: ì‹¤ì œ ì„œë²„ ì €ì¥ì€ Supabase ì—°ë™ í›„ êµ¬í˜„ ì˜ˆì •
function savePortfolio() {
  const session = getSession();
  if (!session) return;
  // ì„œë²„ ì €ì¥ ì˜ˆì • â€” í˜„ì¬ëŠ” localStorageì— ì„ì‹œ ì €ì¥
  const key = 'corryu_portfolio_' + (session.email || 'user');
  localStorage.setItem(key, JSON.stringify(rows));
  showToast('í¬íŠ¸í´ë¦¬ì˜¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
}
function loadSavedPortfolio() {
  const session = getSession();
  if (!session) return;
  const key = 'corryu_portfolio_' + (session.email || 'user');
  try {
    const saved = JSON.parse(localStorage.getItem(key) || 'null');
    if (saved && Array.isArray(saved) && saved.length) rows = saved;
  } catch {}
  renderRows();
}

// â”€â”€ í† ìŠ¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg, type='info') {
  const t = document.createElement('div');
  t.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);padding:10px 20px;border-radius:8px;font-size:0.82rem;font-weight:600;z-index:9999;backdrop-filter:blur(12px);' +
    (type==='success' ? 'background:rgba(74,222,128,0.15);border:1px solid rgba(74,222,128,0.3);color:#4ade80;' : 'background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.3);color:#60a5fa;');
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 2800);
}

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const session = getSession();
if (session) {
  document.getElementById('gate-view').style.display = 'none';
  document.getElementById('portfolio-view').style.display = 'block';
  document.getElementById('user-info-label').textContent =
    (session.displayName || session.email || 'ë¡œê·¸ì¸ë¨') + 'ì˜ í¬íŠ¸í´ë¦¬ì˜¤';
  renderRows();
} else {
  document.getElementById('gate-view').style.display = 'flex';
  document.getElementById('portfolio-view').style.display = 'none';
}

I18n.init();
</script>
</body>
</html>
