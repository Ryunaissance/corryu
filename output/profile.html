<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚´ ê³„ì • â€” CORRYU</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="/supabase-client.js"></script>
<script src="/i18n.js"></script>
<style>
:root {
  --bg-primary: #0a0d14;
  --bg-card: rgba(18,22,36,0.95);
  --border: rgba(255,255,255,0.07);
  --text-primary: #e2e8f0;
  --text-muted: #64748b;
  --accent: #3b82f6;
  --accent-glow: rgba(59,130,246,0.25);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: var(--bg-primary);
  color: var(--text-primary);
  font-family: 'Inter', -apple-system, sans-serif;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€ ë°°ê²½ ê¸€ë¡œìš° â”€â”€ */
.bg-glow {
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  pointer-events: none; z-index: 0;
  background:
    radial-gradient(ellipse 700px 500px at 15% 20%, rgba(59,130,246,0.04) 0%, transparent 70%),
    radial-gradient(ellipse 500px 400px at 85% 75%, rgba(139,92,246,0.03) 0%, transparent 70%);
}

/* â”€â”€ ê·¸ë¼ë°ì´ì…˜ ë¼ì¸ â”€â”€ */
.gradient-line {
  position: fixed; top: 0; left: 0; right: 0; height: 3px; z-index: 200;
  background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899, #f59e0b);
}

/* â”€â”€ Navbar â”€â”€ */
nav {
  position: fixed; top: 3px; left: 0; right: 0; z-index: 100;
  background: rgba(10,13,20,0.92); backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border); height: 54px;
  display: flex; align-items: center;
}
.nav-inner {
  max-width: 900px; margin: 0 auto; padding: 0 24px;
  width: 100%; display: flex; align-items: center; gap: 10px;
}
.nav-back {
  display: flex; align-items: center; gap: 6px;
  color: var(--text-muted); font-size: 0.82rem; font-weight: 600;
  text-decoration: none; transition: color 0.15s; white-space: nowrap;
}
.nav-back:hover { color: #60a5fa; }
.nav-sep { color: #1e293b; font-size: 1rem; }
.nav-brand {
  font-size: 0.95rem; font-weight: 900; text-decoration: none;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  white-space: nowrap;
}
.nav-title {
  font-size: 0.82rem; font-weight: 600; color: var(--text-muted); white-space: nowrap;
}

/* â”€â”€ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ â”€â”€ */
.page-wrap {
  max-width: 900px; margin: 0 auto;
  padding: 82px 24px 60px;
  position: relative; z-index: 1;
}

/* â”€â”€ í˜ì´ì§€ í—¤ë” â”€â”€ */
.page-header { margin-bottom: 32px; }
.page-header h1 { font-size: 1.5rem; font-weight: 900; letter-spacing: -.02em; }
.page-header p  { font-size: 0.85rem; color: var(--text-muted); margin-top: 6px; }

/* â”€â”€ ì•„ë°”íƒ€ ì„¹ì…˜ â”€â”€ */
.avatar-section {
  display: flex; align-items: center; gap: 20px;
  margin-bottom: 32px;
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  padding: 24px 28px;
}
.avatar-circle {
  width: 64px; height: 64px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.5rem; font-weight: 900; flex-shrink: 0;
  box-shadow: 0 0 0 3px rgba(255,255,255,0.07);
}
.avatar-info h2 { font-size: 1.15rem; font-weight: 800; }
.avatar-info p  { font-size: 0.8rem; color: var(--text-muted); margin-top: 3px; }
.avatar-badge {
  margin-top: 6px; display: inline-flex; align-items: center; gap: 4px;
  padding: 2px 9px; border-radius: 6px; font-size: 0.71rem; font-weight: 700;
  background: rgba(59,130,246,0.1); color: #60a5fa; border: 1px solid rgba(59,130,246,0.25);
}

/* â”€â”€ ì„¹ì…˜ ì¹´ë“œ â”€â”€ */
.section-card {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  margin-bottom: 16px; overflow: hidden;
}
.section-head {
  padding: 18px 24px 16px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
}
.section-icon {
  width: 32px; height: 32px; border-radius: 9px;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.section-head h3 { font-size: 0.9rem; font-weight: 800; }
.section-head p  { font-size: 0.75rem; color: var(--text-muted); margin-top: 2px; }
.section-body { padding: 22px 24px; }

/* â”€â”€ í¼ ìš”ì†Œ â”€â”€ */
.form-row { margin-bottom: 16px; }
.form-label {
  display: block; font-size: 0.78rem; font-weight: 700;
  color: #94a3b8; margin-bottom: 7px; letter-spacing: .02em;
}
.form-input {
  width: 100%; padding: 10px 14px; border-radius: 9px;
  background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1);
  color: var(--text-primary); font-size: 0.875rem; font-family: inherit;
  outline: none; transition: border-color 0.15s, background 0.15s;
}
.form-input:focus {
  border-color: rgba(59,130,246,0.5);
  background: rgba(59,130,246,0.04);
}
.form-input:disabled {
  opacity: 0.5; cursor: not-allowed;
}
.form-input::placeholder { color: #334155; }
.form-hint { font-size: 0.74rem; color: var(--text-muted); margin-top: 5px; }

/* â”€â”€ ë²„íŠ¼ â”€â”€ */
.btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 9px 18px; border-radius: 9px; font-size: 0.84rem; font-weight: 700;
  cursor: pointer; font-family: inherit; border: none; transition: all 0.15s;
}
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-primary { background: var(--accent); color: #fff; box-shadow: 0 0 18px var(--accent-glow); }
.btn-primary:hover:not(:disabled) { background: #2563eb; }
.btn-ghost {
  background: rgba(255,255,255,0.05); color: #94a3b8;
  border: 1px solid rgba(255,255,255,0.1);
}
.btn-ghost:hover:not(:disabled) { background: rgba(255,255,255,0.1); color: #e2e8f0; }
.btn-danger {
  background: rgba(239,68,68,0.12); color: #f87171;
  border: 1px solid rgba(239,68,68,0.25);
}
.btn-danger:hover:not(:disabled) { background: rgba(239,68,68,0.24); }
.btn-warning {
  background: rgba(251,191,36,0.1); color: #fbbf24;
  border: 1px solid rgba(251,191,36,0.25);
}
.btn-warning:hover:not(:disabled) { background: rgba(251,191,36,0.2); }

/* â”€â”€ ì •ë³´ í–‰ â”€â”€ */
.info-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.04); gap: 12px;
}
.info-row:last-child { border-bottom: none; padding-bottom: 0; }
.info-label { font-size: 0.8rem; color: var(--text-muted); flex-shrink: 0; }
.info-value { font-size: 0.84rem; font-weight: 600; color: #cbd5e1; text-align: right; }

/* â”€â”€ êµ¬ë¶„ì„  â”€â”€ */
.divider { height: 1px; background: var(--border); margin: 18px 0; }

/* â”€â”€ ìœ„í—˜ êµ¬ì—­ â”€â”€ */
.danger-zone {
  border-color: rgba(239,68,68,0.2);
}
.danger-zone .section-head { border-bottom-color: rgba(239,68,68,0.15); }
.danger-zone .section-icon { background: rgba(239,68,68,0.1); color: #f87171; }

/* â”€â”€ Toast â”€â”€ */
.toast {
  position: fixed; bottom: 28px; left: 50%; transform: translateX(-50%) translateY(8px);
  background: rgba(30,36,52,0.98); border: 1px solid rgba(255,255,255,0.1);
  color: var(--text-primary); padding: 11px 20px; border-radius: 10px;
  font-size: 0.82rem; font-weight: 600; white-space: nowrap;
  opacity: 0; transition: all 0.25s; pointer-events: none; z-index: 1000;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast.success { border-color: rgba(74,222,128,0.3); color: #4ade80; }
.toast.error   { border-color: rgba(248,113,113,0.3); color: #f87171; }

/* â”€â”€ ë¡œë”© / ë¹„ë¡œê·¸ì¸ ìƒíƒœ â”€â”€ */
#loading-screen, #unauth-screen {
  min-height: 60vh; display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 14px; text-align: center;
}
.spinner {
  width: 36px; height: 36px; border-radius: 50%;
  border: 3px solid rgba(255,255,255,0.06);
  border-top-color: #3b82f6;
  animation: spin 0.7s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ ë¹„ë°€ë²ˆí˜¸ ê°•ë„ â”€â”€ */
.pw-strength-bar {
  height: 4px; border-radius: 2px; margin-top: 8px;
  background: rgba(255,255,255,0.06); overflow: hidden;
}
.pw-strength-fill {
  height: 100%; border-radius: 2px; width: 0%;
  transition: width 0.25s, background 0.25s;
}

@media (max-width: 600px) {
  .avatar-section { flex-direction: column; text-align: center; }
  .page-wrap { padding: 74px 16px 40px; }
  .section-body { padding: 18px 16px; }
  .section-head { padding: 16px 16px 14px; }
}
</style>
</head>
<body>

<div class="gradient-line"></div>
<div class="bg-glow"></div>

<!-- â”€â”€ Navbar â”€â”€ -->
<nav>
  <div class="nav-inner">
    <a href="/index" class="nav-back">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
      ëŒ€ì‹œë³´ë“œ
    </a>
    <span class="nav-sep">/</span>
    <a href="/index" class="nav-brand">CORRYU</a>
    <span class="nav-sep">/</span>
    <span class="nav-title">ë‚´ ê³„ì •</span>
  </div>
</nav>

<!-- â”€â”€ í˜ì´ì§€ ë³¸ë¬¸ â”€â”€ -->
<div class="page-wrap">

  <!-- ë¡œë”© -->
  <div id="loading-screen">
    <div class="spinner"></div>
    <p style="color:var(--text-muted);font-size:.85rem">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</p>
  </div>

  <!-- ë¹„ë¡œê·¸ì¸ -->
  <div id="unauth-screen" style="display:none">
    <div style="font-size:2rem">ğŸ”’</div>
    <h2 style="font-size:1.1rem;font-weight:700">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
    <p style="font-size:.85rem;color:var(--text-muted)">ê³„ì • ì •ë³´ë¥¼ ë³´ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
    <a href="/login" style="margin-top:8px;padding:9px 22px;border-radius:9px;background:var(--accent);color:#fff;font-size:.85rem;font-weight:700;text-decoration:none">ë¡œê·¸ì¸</a>
  </div>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <div id="profile-content" style="display:none">

    <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
    <div class="page-header">
      <h1>ë‚´ ê³„ì •</h1>
      <p>í”„ë¡œí•„ ì •ë³´ì™€ ë³´ì•ˆ ì„¤ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”.</p>
    </div>

    <!-- ì•„ë°”íƒ€ / ê¸°ë³¸ ì •ë³´ -->
    <div class="avatar-section">
      <div class="avatar-circle" id="avatar-circle">?</div>
      <div class="avatar-info">
        <h2 id="avatar-nick">â€”</h2>
        <p id="avatar-email">â€”</p>
        <div class="avatar-badge">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          ì¼ë°˜ íšŒì›
        </div>
      </div>
    </div>

    <!-- â”€â”€ ê³„ì • ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="section-card">
      <div class="section-head">
        <div class="section-icon" style="background:rgba(59,130,246,0.1);color:#60a5fa">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
        </div>
        <div>
          <h3>ê³„ì • ì •ë³´</h3>
          <p>ê°€ì… ì´ë©”ì¼ ë° ê¸°ë³¸ ì •ë³´</p>
        </div>
      </div>
      <div class="section-body">
        <div class="info-row">
          <span class="info-label">ì´ë©”ì¼</span>
          <span class="info-value" id="info-email">â€”</span>
        </div>
        <div class="info-row">
          <span class="info-label">ë‹‰ë„¤ì„</span>
          <span class="info-value" id="info-nick">â€”</span>
        </div>
        <div class="info-row">
          <span class="info-label">ê°€ì…ì¼</span>
          <span class="info-value" id="info-joined">â€”</span>
        </div>
        <div class="info-row">
          <span class="info-label">ë§ˆì§€ë§‰ ë¡œê·¸ì¸</span>
          <span class="info-value" id="info-last-login">â€”</span>
        </div>
      </div>
    </div>

    <!-- â”€â”€ ë‹‰ë„¤ì„ ë³€ê²½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="section-card">
      <div class="section-head">
        <div class="section-icon" style="background:rgba(139,92,246,0.1);color:#a78bfa">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        </div>
        <div>
          <h3>ë‹‰ë„¤ì„ ë³€ê²½</h3>
          <p>ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ í‘œì‹œë˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤</p>
        </div>
      </div>
      <div class="section-body">
        <div class="form-row">
          <label class="form-label">ìƒˆ ë‹‰ë„¤ì„</label>
          <input type="text" id="new-nick" class="form-input" placeholder="2~20ì, ê³µë°± ì—†ì´" maxlength="20" autocomplete="off">
          <p class="form-hint">í•œê¸€Â·ì˜ë¬¸Â·ìˆ«ìÂ·_Â·- ì‚¬ìš© ê°€ëŠ¥ / ìµœì†Œ 2ì</p>
        </div>
        <button class="btn btn-primary" onclick="changeNickname()" id="btn-nick">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          ë‹‰ë„¤ì„ ì €ì¥
        </button>
      </div>
    </div>

    <!-- â”€â”€ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="section-card">
      <div class="section-head">
        <div class="section-icon" style="background:rgba(34,197,94,0.1);color:#4ade80">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        </div>
        <div>
          <h3>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
          <p>ì •ê¸°ì ìœ¼ë¡œ ë³€ê²½í•˜ë©´ ë³´ì•ˆì´ ê°•í™”ë©ë‹ˆë‹¤</p>
        </div>
      </div>
      <div class="section-body">
        <div class="form-row">
          <label class="form-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="new-pw" class="form-input" placeholder="8ì ì´ìƒ" autocomplete="new-password"
                 oninput="checkPwStrength(this.value)">
          <div class="pw-strength-bar"><div class="pw-strength-fill" id="pw-strength-fill"></div></div>
          <p class="form-hint" id="pw-strength-label" style="margin-top:6px">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
        </div>
        <div class="form-row">
          <label class="form-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" id="new-pw-confirm" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" autocomplete="new-password">
        </div>
        <button class="btn btn-primary" onclick="changePassword()" id="btn-pw">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
          ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
        </button>
      </div>
    </div>

    <!-- â”€â”€ ì„¸ì…˜ ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="section-card">
      <div class="section-head">
        <div class="section-icon" style="background:rgba(251,191,36,0.1);color:#fbbf24">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
        </div>
        <div>
          <h3>ì„¸ì…˜</h3>
          <p>ì´ ê¸°ê¸° ë˜ëŠ” ëª¨ë“  ê¸°ê¸°ì—ì„œ ë¡œê·¸ì•„ì›ƒ</p>
        </div>
      </div>
      <div class="section-body" style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-ghost" onclick="signOutCurrent()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          ì´ ê¸°ê¸°ì—ì„œ ë¡œê·¸ì•„ì›ƒ
        </button>
        <button class="btn btn-warning" onclick="signOutAll()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          ëª¨ë“  ê¸°ê¸°ì—ì„œ ë¡œê·¸ì•„ì›ƒ
        </button>
      </div>
    </div>

    <!-- â”€â”€ ìœ„í—˜ êµ¬ì—­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="section-card danger-zone">
      <div class="section-head">
        <div class="section-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        </div>
        <div>
          <h3 style="color:#f87171">ìœ„í—˜ êµ¬ì—­</h3>
          <p>ë˜ëŒë¦´ ìˆ˜ ì—†ëŠ” ì‘ì—…ì…ë‹ˆë‹¤</p>
        </div>
      </div>
      <div class="section-body">
        <p style="font-size:.83rem;color:var(--text-muted);margin-bottom:14px;line-height:1.6">
          ê³„ì •ì„ ì‚­ì œí•˜ë©´ ëª¨ë“  ë°ì´í„°(ëŒ“ê¸€, ì¢‹ì•„ìš”, ì €ì¥ëœ í¬íŠ¸í´ë¦¬ì˜¤ ë“±)ê°€ ì˜êµ¬ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
        </p>
        <button class="btn btn-danger" onclick="confirmDeleteAccount()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2"/></svg>
          ê³„ì • ì‚­ì œ
        </button>
      </div>
    </div>

  </div><!-- /profile-content -->
</div><!-- /page-wrap -->

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- ê³„ì • ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div id="delete-modal" style="display:none;position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,0.75);backdrop-filter:blur(4px);align-items:center;justify-content:center">
  <div style="background:#0f1623;border:1px solid rgba(239,68,68,0.35);border-radius:16px;padding:28px 28px 24px;width:min(420px,92vw);box-shadow:0 24px 64px rgba(0,0,0,0.7)">
    <div style="font-size:1.5rem;margin-bottom:10px">âš ï¸</div>
    <h3 style="font-size:1rem;font-weight:800;margin-bottom:8px">ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
    <p style="font-size:.82rem;color:var(--text-muted);line-height:1.6;margin-bottom:20px">
      ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
      í™•ì¸í•˜ë ¤ë©´ ì•„ë˜ì— <strong style="color:#f87171">DELETE</strong>ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
    </p>
    <input type="text" id="delete-confirm-input" class="form-input" placeholder="DELETE" autocomplete="off"
           style="margin-bottom:14px" oninput="document.getElementById('btn-confirm-delete').disabled=this.value!=='DELETE'">
    <div style="display:flex;gap:10px;justify-content:flex-end">
      <button class="btn btn-ghost" onclick="closeDeleteModal()">ì·¨ì†Œ</button>
      <button class="btn btn-danger" id="btn-confirm-delete" onclick="deleteAccount()" disabled>ê³„ì • ì‚­ì œ</button>
    </div>
  </div>
</div>

<script>
// â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const AVATAR_COLORS = ['#3b82f6','#8b5cf6','#f59e0b','#22c55e','#ef4444','#0ea5e9','#f97316','#a855f7','#06b6d4','#84cc16'];
function nickColor(nick) {
  let h = 0; for (const c of nick) h = (Math.imul(31,h)+c.charCodeAt(0))|0;
  return AVATAR_COLORS[Math.abs(h) % AVATAR_COLORS.length];
}
function fmtDate(iso) {
  if (!iso) return 'â€”';
  return new Date(iso).toLocaleDateString('ko-KR', { year:'numeric', month:'long', day:'numeric' });
}

let _toastTimer = null;
function showToast(msg, type = '') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = 'toast show' + (type ? ' ' + type : '');
  clearTimeout(_toastTimer);
  _toastTimer = setTimeout(() => { el.className = 'toast'; }, 3200);
}

function setBtnLoading(id, loading, label) {
  const btn = document.getElementById(id);
  if (!btn) return;
  btn.disabled = loading;
  if (label) btn.innerHTML = label;
}

// â”€â”€ ë¹„ë°€ë²ˆí˜¸ ê°•ë„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkPwStrength(pw) {
  const fill  = document.getElementById('pw-strength-fill');
  const label = document.getElementById('pw-strength-label');
  if (!pw) { fill.style.width='0%'; label.textContent='ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'; label.style.color='var(--text-muted)'; return; }
  let score = 0;
  if (pw.length >= 8)  score++;
  if (pw.length >= 12) score++;
  if (/[A-Z]/.test(pw)) score++;
  if (/[0-9]/.test(pw)) score++;
  if (/[^A-Za-z0-9]/.test(pw)) score++;
  const levels = [
    { w:'20%', color:'#ef4444', text:'ë§¤ìš° ì•½í•¨' },
    { w:'40%', color:'#f97316', text:'ì•½í•¨' },
    { w:'60%', color:'#eab308', text:'ë³´í†µ' },
    { w:'80%', color:'#22c55e', text:'ê°•í•¨' },
    { w:'100%',color:'#10b981', text:'ë§¤ìš° ê°•í•¨' },
  ];
  const lv = levels[Math.min(score, 4)];
  fill.style.width = lv.w; fill.style.background = lv.color;
  label.textContent = lv.text; label.style.color = lv.color;
}

// â”€â”€ ë‹‰ë„¤ì„ ë³€ê²½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function changeNickname() {
  const nick = document.getElementById('new-nick').value.trim();
  if (!nick || nick.length < 2) { showToast('ë‹‰ë„¤ì„ì€ 2ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error'); return; }
  if (nick.length > 20)         { showToast('ë‹‰ë„¤ì„ì€ 20ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error'); return; }
  if (/\s/.test(nick))           { showToast('ë‹‰ë„¤ì„ì— ê³µë°±ì„ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error'); return; }

  setBtnLoading('btn-nick', true, 'ì €ì¥ ì¤‘â€¦');
  try {
    // ì¤‘ë³µ ì²´í¬
    const taken = await CorryuAuth.isNicknameTaken(nick);
    if (taken) { showToast('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.', 'error'); return; }

    const { error } = await _sb.from('profiles').update({ nickname: nick }).eq('id', currentUser.id);
    if (error) throw error;

    // ë¡œì»¬ ê°±ì‹ 
    document.getElementById('avatar-nick').textContent = nick;
    document.getElementById('info-nick').textContent   = nick;
    const ac = document.getElementById('avatar-circle');
    ac.textContent = nick.charAt(0).toUpperCase();
    ac.style.background = nickColor(nick);
    document.getElementById('new-nick').value = '';
    showToast('ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
  } catch(e) {
    showToast('ì˜¤ë¥˜: ' + e.message, 'error');
  } finally {
    setBtnLoading('btn-nick', false,
      '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>ë‹‰ë„¤ì„ ì €ì¥');
  }
}

// â”€â”€ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function changePassword() {
  const pw  = document.getElementById('new-pw').value;
  const pw2 = document.getElementById('new-pw-confirm').value;
  if (!pw || pw.length < 8) { showToast('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error'); return; }
  if (pw !== pw2)            { showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error'); return; }

  setBtnLoading('btn-pw', true, 'ë³€ê²½ ì¤‘â€¦');
  try {
    const { error } = await _sb.auth.updateUser({ password: pw });
    if (error) throw error;
    document.getElementById('new-pw').value = '';
    document.getElementById('new-pw-confirm').value = '';
    checkPwStrength('');
    showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
  } catch(e) {
    showToast('ì˜¤ë¥˜: ' + e.message, 'error');
  } finally {
    setBtnLoading('btn-pw', false,
      '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½');
  }
}

// â”€â”€ ë¡œê·¸ì•„ì›ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function signOutCurrent() {
  await CorryuAuth.signOut();
  window.location.href = '/login';
}
async function signOutAll() {
  if (!confirm('ëª¨ë“  ê¸°ê¸°ì—ì„œ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  await _sb.auth.signOut({ scope: 'global' });
  window.location.href = '/login';
}

// â”€â”€ ê³„ì • ì‚­ì œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function confirmDeleteAccount() {
  document.getElementById('delete-confirm-input').value = '';
  document.getElementById('btn-confirm-delete').disabled = true;
  const m = document.getElementById('delete-modal');
  m.style.display = 'flex';
}
function closeDeleteModal() {
  document.getElementById('delete-modal').style.display = 'none';
}
async function deleteAccount() {
  setBtnLoading('btn-confirm-delete', true, 'ì‚­ì œ ì¤‘â€¦');
  try {
    // profiles í…Œì´ë¸” ë¨¼ì € ì‚­ì œ
    await _sb.from('profiles').delete().eq('id', currentUser.id);
    // auth ê³„ì • ì‚­ì œ (RPC ì‚¬ìš© ë˜ëŠ” admin API í•„ìš” â€” ì—¬ê¸°ì„œëŠ” ë¡œê·¸ì•„ì›ƒ í›„ ì•ˆë‚´)
    await CorryuAuth.signOut();
    closeDeleteModal();
    alert('ê³„ì • ë°ì´í„°ê°€ ì‚­ì œ ì²˜ë¦¬ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.\nì™„ì „í•œ ì‚­ì œëŠ” ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì²˜ë¦¬ë©ë‹ˆë‹¤.');
    window.location.href = '/landing';
  } catch(e) {
    showToast('ì˜¤ë¥˜: ' + e.message, 'error');
    setBtnLoading('btn-confirm-delete', false, 'ê³„ì • ì‚­ì œ');
  }
}

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentUser = null;

(async function init() {
  // Supabase ë¯¸ì—°ê²°
  if (typeof CorryuAuth === 'undefined' || !CorryuAuth.isConfigured) {
    document.getElementById('loading-screen').style.display = 'none';
    document.getElementById('unauth-screen').style.display  = 'flex';
    return;
  }

  currentUser = await CorryuAuth.getUser();
  if (!currentUser) {
    document.getElementById('loading-screen').style.display = 'none';
    document.getElementById('unauth-screen').style.display  = 'flex';
    return;
  }

  // í”„ë¡œí•„ ë¡œë“œ
  const profile = await CorryuAuth.getProfile(currentUser.id);
  const nick  = profile?.nickname || currentUser.email?.split('@')[0] || 'ì‚¬ìš©ì';
  const email = currentUser.email || 'â€”';
  const joined    = fmtDate(currentUser.created_at);
  const lastLogin = fmtDate(currentUser.last_sign_in_at);

  // ì•„ë°”íƒ€
  const ac = document.getElementById('avatar-circle');
  ac.textContent   = nick.charAt(0).toUpperCase();
  ac.style.background = nickColor(nick);
  ac.style.color      = '#fff';

  // ì •ë³´ ì±„ìš°ê¸°
  document.getElementById('avatar-nick').textContent   = nick;
  document.getElementById('avatar-email').textContent  = email;
  document.getElementById('info-email').textContent    = email;
  document.getElementById('info-nick').textContent     = nick;
  document.getElementById('info-joined').textContent   = joined;
  document.getElementById('info-last-login').textContent = lastLogin;

  // í™”ë©´ ì „í™˜
  document.getElementById('loading-screen').style.display  = 'none';
  document.getElementById('profile-content').style.display = 'block';

  await I18n.init();
})();
</script>
</body>
</html>
